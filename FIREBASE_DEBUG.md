# Guide de Debug Firebase - Timeless

## ‚úÖ Corrections appliqu√©es

### 1. Configuration Gradle
- **Ajout√©** le plugin Google Services dans `android/build.gradle.kts` (version 4.4.2)
- **Corrig√©** les chemins dans `android/local.properties` pour compatibilit√© WSL
- **V√©rifi√©** que `google-services.json` est pr√©sent et configur√©

### 2. Impl√©mentation Google Sign-In
- **Cr√©√©** `lib/service/google_auth_service.dart` - service centralis√©
- **Am√©lior√©** la gestion d'erreurs dans `sign_in_controller.dart`
- **Ajout√©** des logs de debug d√©taill√©s
- **Impl√©ment√©** double strat√©gie : `google_sign_in` package + Firebase Auth

### 3. Service de test
- **Cr√©√©** `lib/dev/firebase_test.dart` pour diagnostiquer les probl√®mes

## üîç Comment tester

### Test rapide depuis l'app
```dart
// Ajoutez dans main.dart ou un √©cran de debug :
import 'package:timeless/dev/firebase_test.dart';

// Dans un bouton ou au d√©marrage :
await FirebaseTestService.runAllTests();
```

### Test depuis Android Studio
1. **Lancer l'app** avec `flutter run`
2. **Observer les logs** dans la console Android Studio
3. **Chercher les messages** :
   - `‚úÖ` = succ√®s
   - `‚ùå` = √©chec 
   - `‚ö†Ô∏è` = avertissement

## üêõ Diagnostics courants

### Google Sign-In ne fonctionne pas
**Sympt√¥mes** : Popup ne s'ouvre pas ou erreur `DEVELOPER_ERROR`

**V√©rifications** :
1. **SHA1/SHA256** dans Firebase Console :
   ```bash
   cd android
   ./gradlew signingReport
   # Copier les empreintes dans Firebase Console > Project Settings > General
   ```

2. **Package name** : Doit √™tre `com.example.timeless` partout
3. **Web Client ID** configur√© dans GoogleSignIn (fait ‚úÖ)

### Firestore connexion √©choue
**Sympt√¥mes** : `permission-denied` ou timeout

**V√©rifications** :
1. **Rules Firestore** : V√©rifier dans Firebase Console > Firestore > Rules
2. **R√©seau** : Tester avec donn√©es mobiles si WiFi pose probl√®me
3. **Auth state** : S'assurer que l'utilisateur est connect√© avant l'acc√®s

### Firebase initialization fails
**Sympt√¥mes** : App crash au d√©marrage

**V√©rifications** :
1. **google-services.json** pr√©sent dans `android/app/`
2. **firebase_options.dart** g√©n√©r√© correctement
3. **Plugins Gradle** appliqu√©s correctement

## üì± Test dans Android Studio

### Logs √† surveiller
```bash
# Pour voir tous les logs Firebase
flutter run --verbose

# Ou filtrer dans Android Studio Logcat :
firebase
google
timeless
```

### Messages de succ√®s attendus
```
‚úÖ Firebase Auth initialized
‚úÖ Firestore connection successful  
‚úÖ Google Sign-In successful
‚úÖ User data saved to Firestore
```

## üö® Actions de d√©pannage

### Si Google Sign-In √©choue
1. **V√©rifier SHA1** : G√©n√©rer et ajouter dans Firebase Console
2. **Clear cache** :
   ```bash
   flutter clean
   cd android && ./gradlew clean
   flutter pub get
   ```

### Si Firestore √©choue
1. **Test avec rules permissives** (temporairement) :
   ```javascript
   rules_version = '2';
   service cloud.firestore {
     match /databases/{database}/documents {
       match /{document=**} {
         allow read, write: if true; // TEMPORAIRE SEULEMENT
       }
     }
   }
   ```

### Si Firebase initialization √©choue
1. **Re-run FlutterFire CLI** :
   ```bash
   dart pub global activate flutterfire_cli
   flutterfire configure
   ```

## üéØ Points de contr√¥le finaux

- [ ] App d√©marre sans crash
- [ ] Firebase Auth initialized (voir logs)
- [ ] Firestore connexion OK (voir logs) 
- [ ] Google Sign-In ouvre popup/intent Android
- [ ] Utilisateur connect√© arriv√© au dashboard
- [ ] Donn√©es sauv√©es dans Firestore

## üìû Support

Si les probl√®mes persistent :
1. **Activer tous les logs** avec `flutter run --verbose`
2. **Copier les logs d'erreur** complets
3. **V√©rifier la console Firebase** pour les erreurs c√¥t√© serveur
4. **Tester sur device physique** si √©mulateur pose probl√®me