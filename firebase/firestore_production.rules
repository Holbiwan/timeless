// --- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 



// FIRESTORE SECURITY RULES
// Règles de sécurité Firestore (FR + EN)
// --- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 




rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // --------------------------------------------------------
    // USERS COLLECTION
    // Utilisateurs → accès uniquement à leurs propres données
    // Users can only read/write their own data
    // --------------------------------------------------------
    match /users/{userId} {

      // Read/write allowed only for the authenticated user
      // Lecture/écriture réservées à l’utilisateur connecté
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Basic validation for user creation
      // Validation minimale lors de la création du document
      allow create: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.data.keys().hasAll(['email', 'fullName', 'userType']);
    }
    
    // --------------------------------------------------------
    // JOB POSTS (DEMO PERMISSIVE)
    // Offres d’emploi (règles permissives pour démo)
    // --------------------------------------------------------
    match /allPost/{jobId} {

      // Logged-in users can read job posts
      // Lecture permise pour les utilisateurs connectés
      allow read: if request.auth != null;

      // Write allowed for demo/testing
      // Écriture autorisée pour la démo
      allow write: if request.auth != null;
    }
    
    // --------------------------------------------------------
    // JOB CATEGORIES
    // Catégories d’emploi
    // --------------------------------------------------------
    match /category/{categoryName}/{subcollection=**} {

      // Public read for authenticated users
      // Lecture publique pour utilisateurs connectés
      allow read: if request.auth != null;

      // Write allowed (demo only)
      // Écriture autorisée (démo uniquement)
      allow write: if request.auth != null;
    }
    
    // --------------------------------------------------------
    // JOB APPLICATIONS
    // Candidatures → accès personnel uniquement
    // --------------------------------------------------------
    match /Apply/{userId} {

      // User can read/write their own applications
      // Un utilisateur gère uniquement ses propres candidatures
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Basic validation for creation
      // Validation des champs minimum
      allow create: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.data.keys().hasAll(['userName', 'email']);
    }
    
    // --------------------------------------------------------
    // USER CVS
    // CV stockés → accès personnel uniquement
    // --------------------------------------------------------
    match /UserCVs/{userId}/{subcollection=**} {
      // User-only access
      // Accès réservé à l’utilisateur
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // --------------------------------------------------------
    // FAVORITES / BOOKMARKS
    // Favoris → accès personnel uniquement
    // --------------------------------------------------------
    match /BookMark/{userId}/{subcollection=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // --------------------------------------------------------
    // CHAT SYSTEM
    // Messages et salons → accès utilisateurs connectés
    // --------------------------------------------------------
    match /chatRoom/{chatId} {
      allow read, write: if request.auth != null;
    }

    match /chatRoom/{chatId}/messages/{messageId} {
      allow read, write: if request.auth != null;
    }
    
    // --------------------------------------------------------
    // DEMO COLLECTIONS
    // Collections dédiées aux tests/démo
    // --------------------------------------------------------
    match /demo/{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // --------------------------------------------------------
    // DEFAULT RULES (DEV MODE)
    // Règles par défaut permissives (développement)
    // --------------------------------------------------------
    match /{document=**} {

      // READ allowed for logged-in users
      // Lecture permise pour utilisateurs connectés
      allow read: if request.auth != null;

      // WRITE allowed for logged-in users (DEV MODE ONLY)
      // Écriture permise pour utilisateurs connectés (DEV UNIQUEMENT)
      allow write: if request.auth != null;
    }
  }
}


// --- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 



// FIREBASE STORAGE RULES
// Règles de sécurité Firebase Storage (FR + EN)
// --- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 


--- SECTION: 




service firebase.storage {
  match /b/{bucket}/o {
    
    // --------------------------------------------------------
    // USER CVS
    // CV utilisateur → accès personnel uniquement
    // --------------------------------------------------------
    match /cv/{userId}/{fileName} {

      // User can upload/view own CV
      // L’utilisateur peut gérer ses propres CV
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Validate file size (max 10MB)
      // Validation taille max 10MB
      allow create: if request.auth != null 
        && request.auth.uid == userId
        && resource.size < 10 * 1024 * 1024;
    }
    
    // --------------------------------------------------------
    // PROFILE PICTURES
    // Photos de profil → accès personnel uniquement
    // --------------------------------------------------------
    match /profile_pictures/{userId}/{fileName} {

      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Max 5MB
      // Taille max 5MB
      allow create: if request.auth != null 
        && request.auth.uid == userId
        && resource.size < 5 * 1024 * 1024;
    }
    
    // --------------------------------------------------------
    // COMPANY IMAGES
    // Images d’entreprise
    // --------------------------------------------------------
    match /company_images/{userId}/{fileName} {

      // Read allowed for authenticated users
      // Lecture pour utilisateurs connectés
      allow read: if request.auth != null;

      // Write only for the owner
      // Écriture réservée au propriétaire
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // --------------------------------------------------------
    // DEFAULT STORAGE RULES (DEV MODE)
    // Règles permissives pour développement/démo
    // --------------------------------------------------------
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
